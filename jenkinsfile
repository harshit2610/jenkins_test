pipeline {
  agent any
   parameters {
  string defaultValue: 'harshit2610/fibonnaci', description: 'image name', name: 'image_name'
}
  stages {
    stage('Build Docker image') {
      steps {
        script {
          docker.build("${params.image_name}:2.0")
        }
      }
    }
    stage('Push to Docker Hub') {
      steps {
        script {
          docker.withRegistry('https://registry.hub.docker.com', 'docker_harshit') {
            docker.image("${params.image_name}:2.0").push()
          }
        }
      }
    }
   stage('Build and Push Docker Image') {
            steps {
                script {
                def dockerImage = docker.build("sre-training/harshit-fibonacci:2.0", "-f Dockerfile .")
                    
                        docker.withRegistry('https://harbor.cubastion.net', 'harbor_sre') {
                            dockerImage.push()
                        }
                    
                }
            }
        }
      stage('Cleanup') {
      steps {
        cleanWs()
      }
    }
  }
}
